<!DOCTYPE html>
<html lang="en">
    <head>
        <title>HTML TTS TEST</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <button onclick="talk('가');">가</button>
        <button onclick="talk('나');">나</button>
        <button onclick="talk('다');">다</button>
        <button onclick="talk('라');">라</button>
        <button onclick="talk('마');">마</button>
        <button onclick="talk('바');">바</button>
        <button onclick="talk('사');">사</button>
        <button onclick="talk('아');">아</button>
        <button onclick="talk('자');">자</button>
        <button onclick="talk('차');">차</button>
        <button onclick="talk('카');">카</button>
        <button onclick="talk('타');">타</button>
        <button onclick="talk('파');">파</button>
        <button onclick="talk('하');">하</button>
        <textarea id="txtTotalk"></textarea>
        <input type="button" value="말하기" onclick="talk();"/>

        <select id="voices"></select>
        Pitch : <input id="pitch" type="text" value="1">
        Rate :  <input id="rate" type="text" value="1">
        <a href="./www/index.html">StudyGame</a>
        <script>
            var voices = [];
            function setVoiceList() {
                const elVoice = document.getElementById("voices");
                voices = window.speechSynthesis.getVoices();
                voices.forEach(vo => {
                    let opt = document.createElement("option");
                    opt.text = vo.name + "," + vo.lang;
                    opt.value = vo.name + "," + vo.lang;
                    elVoice.options.add(opt);
                });
                
                console.log(voices);
            }
            setVoiceList();
            if (window.speechSynthesis.onvoiceschanged !== undefined) {
                window.speechSynthesis.onvoiceschanged = setVoiceList;
            }
            function speech(txt) {
                if(!window.speechSynthesis) {
                    alert("음성 재생을 지원하지 않는 브라우저입니다. 크롬, 파이어폭스 등의 최신 브라우저를 이용하세요");
                    return;
                }
                //var lang = 'ko-KR';
                var utterThis = new SpeechSynthesisUtterance(txt);
                utterThis.onend = function (event) {
                    console.log('end');
                };

                utterThis.onerror = function(event) {
                    console.log('error', event);
                };
                
                // var voiceFound = false;
                // for(var i = 0; i < voices.length ; i++) {
                //     if(voices[i].lang.indexOf(lang) >= 0 || voices[i].lang.indexOf(lang.replace('-', '_')) >= 0) {
                //         utterThis.voice = voices[i];
                //         voiceFound = true;
                //     }
                // }
                // if(!voiceFound) {
                //     alert('voice not found');
                //     return;
                // }
                const voice = voices[document.getElementById("voices").selectedIndex];
                const pitch = document.getElementById("pitch").value.split(",");
                const rate = document.getElementById("rate").value.split(",");
                alert(voice.name + "," + voice.lang + "," + pitch + "," + rate);
                utterThis.voice = voice;
                utterThis.lang = voice.lang;
                utterThis.pitch = pitch;
                utterThis.rate = rate; //속도
                window.speechSynthesis.speak(utterThis);
            }
            // document.addEventListener("click", function(e) {
            // var t = e.target;
            // var input = t.previousElementSibling;
            // speech(input.value);
            // });
            function talk() {
                const txt = document.getElementById("txtTotalk").value;
                speech(txt);
            }
        </script>
    </body>
</html>
